<!DOCTYPE html>
<html>
  <head>
    <title>Introduction to conan.io</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }

      .large-code .remark-inline-code {
        font-size: 2em;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <textarea id="source">
class: middle, center

# Conan.io
## C/C++ dependency management made easy
### Javier Povedano, PhD (javier@rti.com)

---

layout: true
class: middle

---
class: middle

# Why a package manager?

- Separate external dependencies from source code
- Reproducible builds
- Better vulnerability management

---
class: middle

# Every language has its own package manager

- Java: `Maven`, `gradle*`
- Python: `pip`
- JavaScript: `npm`, `yarn`
- Perl: `CPAN`
- .NET: `NuGet`
- C/C++: ??????????????

---
class: middle

# What is Conan.io

- Conan is a decentralized package manager with a client-server architecture
- OpenSource
- Focused in C/C++
- Written in Python
- Source code based
- Based on recipes
- Generate configuration files that can be consumed by other build systems (e.g. `CMake`)
- Store pre-compiled binaries in repository (`JFrog Artifactory`)

---
class: middle

# Conan concepts

#### recipe
`Python` file that contains instructions to build and install a package
#### package
Pre-compiled binary (headers, libraries, executables)
#### cache
local storage for recipes and pre-compiled packages (`~/.conan`)
#### conanfile.txt
A file that contains information about dependencies

---

class: middle

# Conan concepts

#### setting
Project-wide configuration. Common to all packages (os, arch, compiler)
#### option
Package specific configuration (e.g. shared library)
#### Profile
A preset that contains some specific settings (e.g. x86_64Linux with gcc 5.4)
#### Generator
Output generated by `Conan` (e.g. `CMake`, `json`, `txt`, ...)

---

class: center

<img width="80%" src="imgs/conan-binary_mgmt.png"/>

---

# How it works

1. Checks if the package recipe exists in the local cache.
2.  Looks for the package recipe in the defined remotes.
3. If the recipe exists, the Conan client fetches and stores it in your local cache.
4. With the package recipe and the input settings (Linux, GCC), Conan looks for the corresponding binary in the local cache.
5. Then Conan searches the corresponding binary package in the remote and fetches it.
6. Finally, it generates an appropriate file for the build system specified in the [generators] section.

---
class: middle

# Package naming

.large-code[`name/version@user/channel`]

- `openssl/1.0.2o@rti/stable`
- `openssl/1.0.2o@javier/testing`
- `connextdds/6.0.0@rti/stable`

---

# `conanfile.txt`

For package consumers

```ini
[requires]
Poco/1.9.0@pocoproject/stable
zlib/1.2.11@conan/stable

[generators]
cmake

[options]
Poco:shared=True
OpenSSL:shared=True
```
---

# `conanfile.py`

For package developer/maintainers

```Python

class FooConan(ConanFile):
    name = "foo"
    version = "1.0.0"
    settings = "os", "compiler", "build_type", "arch"
    generators = "cmake"

    def source(self):
        # Download/Retrieve the source code.

    def build(self):
        # Build source code

    def package(self):
        # Copy artifacts from build to package folder

    def package_info(self):
        # Provide compiler/linker definitions to consumers

```

---

# Profile

- Define settings/options different than the default ones
- Useful for cross-compiling

```ini
[settings]
os=Linux
os_build=Linux
arch=x86_64
arch_build=x86_64
compiler=gcc
compiler.version=7
compiler.libcxx=libstdc++
build_type=Release
[options]
[build_requires]
[env]
```

---
class: middle

# Installation

.large-code[
```console
# pip install conan
```
]

- `Conan` provides a command line interface

---


# Consumer commands: `config`

Download organization-wide configuration from a remote url:

- remote repositories
- profiles
- supported settings

```bash
conan config install <url>
```

---
# Consumer commands: `search`

Search a specific package in local cache and remotes

```bash
conan search package/version@user/channel [-r <remote>]
```

---
# Consumer commands: `install`

Download and install a pre-compiled binary package on the cache

```bash
conan install package/version@user/channel [--profile <myprofile>]
```
---

# Maintainer commands: `export`

Copies the recipe in the current directory to the local cache.

```bash
conan export . user/channel
```
---

# Maintainer commands: `new`

Generate boilerplate for a recipe

```bash
conan new . package/version@user/channel
```
---

# Maintainer commands: `create`

Create a binary package for current settings

```bash
conan create . user/channel
```
---

# Maintainer commands: `upload`

Upload recipe/packages to repository (e.g. Artifactory)
```bash
conan upload . user/channel
```
---
class: center, middle

# Demo

    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>